#!/bin/sh

export FPRIME_ROOT=`cd ../..; echo $PWD`

deps=`fpp-depend $FPRIME_ROOT/defs.fpp Cmd.fpp`
comma_deps=`echo $deps | sed 's/ /,/g'`
fpp-to-xml -p $FPRIME_ROOT -i $comma_deps Cmd.fpp

# Codegen workarounds
for name in Cmd CmdReg CmdResponse
do
  xml_file=$name'PortAi.xml'
  cat $xml_file | \
    # Suppress header for FwOpcodeType
    awk '/FwOpcodeType\.hpp/ { next } { print }' > tmp.xml
  mv tmp.xml $xml_file
done
